---
    - name: Install and configure software for rpi-kickstart
      gather_facts: True
      hosts: localhost
      connection: local
      tasks:
        - name: Update apt repositories
          when: ansible_os_family == "Debian"
          apt:
            update_cache: yes
            cache_valid_time: 86400
        - name: Install dnsmasq package
          when: ansible_os_family == "Debian"
          apt:
            name: dnsmasq
            state: latest
        - name: Install dnsmasq package
          when: ansible_os_family == "RedHat"
          yum:
            name: dnsmasq
            state: latest
        - name: Install nginx package
          when: ansible_os_family == "Debian"
          apt:
            name: nginx
            state: latest
        - name: Install nginx package
          when: ansible_os_family == "RedHat"
          yum:
            name: nginx
            state: latest
        - name: Install pxelinux package
          when: ansible_os_family == "Debian"
          apt:
            name: pxelinux
            state: latest
        - name: Populate dnsmasq main configuration file
          copy:
             src: files/dnsmasq.conf
             dest: /etc/dnsmasq.conf
             owner: root
             group: root
             mode: 0644
